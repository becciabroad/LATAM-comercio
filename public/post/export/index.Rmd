---
title: Exportación
author: Rebecca Hoffmann
date: '2021-01-09'
slug: export
categories: []
tags: []
draft: false
output:
  blogdown::html_page
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE)
```
En este post, el objetivo es analizar la composición de las exportaciones en América Latina. Cómo hemos visto en los últimos posts, el comercio exterior han aumentado en América Latina desde los años 1990s. Pero aún parece que hay una sesgo en qué tipo de productos se importa y exporta en la región. Por lo tanto, en este post se enfoca en las exportaciones de la región.

En el post sobre el desarrollo histórico del comercio exterior en América Latina, ya vimos unas tendencias, pero en este post desarrolla el tema sobre las exportaciones. 

El post está divido en dos partes:

(1) Un analisis sobre los niveles de exportación de los países de América Latina en 2018 utilizando un mapa estilo cartograma. Si aún no tienes el paquete de cartograma se puede descargar con el siguiente comando:

install.packages("cartogram")
utilizando los guías de aca: https://github.com/sjewo/cartogram

(2) Un analisis sobre las categorías de productos que los países más exportaron durante el 2018.

### Las libraría utilizadas:

```{r libraries, warning=FALSE, message=F}
library(tidyverse)
library(tradestatistics)
library(ggplot2)
library(ggthemes)
library(scales)
library(maptools)
library(cartogram)
```

## Cartograma de las exportaciones en América Latina

### Descargando los datos
Cómo en el post sobre importación necesito descargar dos diferentes data frames desde el base de datos de Open Trade Statistics y después unirlos en uno para separar la región de las Americas:
```{r comercio API, message=FALSE}
comercio_mundo_api <- tradestatistics::ots_create_tidy_data(
  years = 2018, 
  reporters = "all", 
  partners = "all", 
  products = "all") %>%
  rename(country_iso = 'reporter_iso')

countries_LATAM <- tradestatistics::ots_countries %>%
  filter(continent == "Americas") 

export_latam <- merge(x = comercio_mundo_api, y = countries_LATAM,
      by = "country_iso") %>%
  select(country_iso,
         reporter_fullname_english,
         export_value_usd,
         top_export_trade_value_usd,
         top_export_product_code) %>%
  filter(
         reporter_fullname_english != "USA, Puerto Rico and US Virgin Islands (excludes Virgin Islands until 1981)",
         reporter_fullname_english != "Canada",
         reporter_fullname_english != "Greenland",
         reporter_fullname_english != "Br. Virgin Isds",
         reporter_fullname_english != "United States Minor Outlying Islands",
         reporter_fullname_english != "South Georgia and the South Sandwich Islands") %>% # Saco los países no correspondiendo a América Latina
  drop_na()


```



### Generando el cartograma

```{r mapa, message=FALSE, warning=FALSE}
library(sf)
library(rgdal)
library(tmap)
library(broom)

# Data of world map:
data(wrld_simpl)
# Eligo el subset de América de Sur y América Central
latam <- subset(wrld_simpl,wrld_simpl$SUBREGION==5|wrld_simpl$SUBREGION==13) 

# Generando un "spacial element"
latam <- spTransform(latam, CRS("+init=epsg:31972"))

latam@data = latam@data %>%
  mutate(reporter_fullname_english = latam$NAME)

# creating the data frame with the export data:
export_latam_2018 <- data.frame(reporter_fullname_english = export_latam$reporter_fullname_english, export = export_latam$export_value_usd)

latam@data <- latam@data %>% left_join(., export_latam_2018, by=c("NAME" = "reporter_fullname_english"))

cartogram <- cartogram_cont(latam, 'export', itermax = 7)

tm_shape(cartogram) + tm_polygons("export", style = "jenks") +
  tm_layout(frame = FALSE, legend.position = c("left", "bottom")) +
  labs(title = "Exportación 2018 América Latina")
```

### Sum-up


## Exportaciones por categorías de productos
En esta parte, quiero realizar una breve analisis de qué categoría de producto los país exporta más.

### Transformando los datos
Como hice en el analisis sobre importaciones, necesito descargar el data frame con los nombres de los productos y después unirlo con el data frame que generé antes. Para no tener un grafico muy largo excluyo todos los pequeños países del Caribe:

```{r comercio LATAM productos, message=FALSE}
productos_latam <- tradestatistics::ots_products_shortnames %>%
  rename(top_export_product_code = "product_code")

productos_latam_export <- merge(x = export_latam, 
                                y = productos_latam, 
                                by = 'top_export_product_code') %>%
  filter(reporter_fullname_english != "Anguilla",
         reporter_fullname_english != "Neth. Antilles",
         reporter_fullname_english != "Antigua and Barbuda",
         reporter_fullname_english != "Bahamas",
         reporter_fullname_english != "Bahamas",
         reporter_fullname_english != "Barbados",
         reporter_fullname_english != "Belize",
         reporter_fullname_english != "Bermuda",
         reporter_fullname_english != "Bouvet Island",
         reporter_fullname_english != "Cocos Isds",
         reporter_fullname_english != "Cayman Isds",
         reporter_fullname_english != "Cuba",
         reporter_fullname_english != "Grenada",
         reporter_fullname_english != "Guyana",
         reporter_fullname_english != "Haiti",
         reporter_fullname_english != "Jamaica",
         reporter_fullname_english != "Saint Kitts and Nevis (includes Anguilla until 1981)",
         reporter_fullname_english != "Saint Lucia",
         reporter_fullname_english != "Montserrat",
         reporter_fullname_english != "Saint Pierre and Miquelon",
         reporter_fullname_english != "Suriname",
         reporter_fullname_english != "Turks and Caicos Isds",
         reporter_fullname_english != "Trinidad and Tobago",
         reporter_fullname_english != "Saint Vincent and the Grenadines") %>%
  drop_na()
 
```

Modifico la columna "reporter_fullname_english" para que sea un factor, porqué eso me permite modificar los nombres de las observaciones y juntarlos en la misma observación:
```{r LATAM productos factor, message=FALSE}
productos_factor <- productos_latam_export %>%
  mutate(reporter_fullname_english = as.factor(reporter_fullname_english))
```

Ahora eligo las columnas que necesito para graficar, y modifico el nombre de Panama y junto Argentina y Malvinas en un grupo:
```{r LATAM productos modificar, message=FALSE}
export_countries_2018 <- productos_factor %>%
  select(reporter_fullname_english,
         top_export_trade_value_usd,
         product_shortname_english) %>%
  mutate(reporter_fullname_english = fct_collapse(reporter_fullname_english,
             "Panama"    = c("Panama (excludes Panama Canal Zone until 1978)"),
             "Argentina" = c("Argentina", 
                             "Falkland Isds (Malvinas)"))) %>%
  group_by(reporter_fullname_english,
           product_shortname_english)
```

### Graficando
Ahora estoy lista para graficar: 

```{r comercio LATAM productos graficar, message=FALSE}
ggplot(export_countries_2018, aes(
  x = reporter_fullname_english,
  y = top_export_trade_value_usd,
  fill = product_shortname_english)) +
    geom_col() +
  labs(
    x = NULL,
    y = NULL,
    fill = NULL,
    title = "Exportaciones por producto (2018)",
    caption = "Fuerte: Open Trade Statistics") +
  scale_y_continuous(labels = scales::dollar_format()) +
  theme_economist() +
  theme(
    plot.title = element_text(size = 14),
    axis.text.x = element_text(size = 9),
    axis.text.y = element_text(size=9),
    legend.text = element_text(size = 8),
    legend.title = element_blank(),
    legend.position = "bottom") +
  coord_flip()

```


### Sum-up
En primer lugar, se nota que el perfil de exportación de los países latinoamericanos es mucho más diverso que el perfil de importación donde la mayoría importan petroleo refinado. 

En segundo lugar, también llama la atención que México de nuevo es el mayor comerciante, lo cual explica su posición fuerte en el primer analisis que hice sobre la evolución del comercio exterior. Además, México es el único país en la región que tiene los autos como principal producto de exportación. 