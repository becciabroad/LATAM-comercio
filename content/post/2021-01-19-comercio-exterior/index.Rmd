---
title: Comercio Exterior
author: Rebecca Hoffmann
date: '2021-01-19'
slug: comercio-exterior
categories: []
tags: []
draft: false
output:
  blogdown::html_page
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE)
```

En este post, quiero analizar la evolución historico del comercio desde los 1980s hasta 2018 (el último año disponible en el base de datos) para toda la región de América Latin utilizando el base de dato de Open Trade Statistics. 

El post está divido en tres analisis diferentes:
(1) Un analisis del desarrollo del conjunto de exportaciones y importaciones de toda la región en conjunto. 
(2) Un analisis de la evolución del comercio de los países en la región para poder analizar quién cuales son los mayores comerciante en la región. Por comercio se entiendo el combinado valor de importaciones y exportaciones. 
(3) Por último, un analisis del desarrollo desde los 1980s en las mayores categorías de productos importados en la región.

Cómo clave para este post es el analisis historico de los datos sobre América Latina. En los siguientes posts, analizo por separado los flujos de importación y exportación en los últimos años. 

### Las libraría utilizadas:

```{r libraries, message=F}
library(tidyverse)
library(tradestatistics)
library(ggplot2)
library(ggthemes)
library(scales)
library(patchwork)
```

## Preparando los datos

### Descargando los datos
En primer lugar, descargo los datos que voy a utilizar de el base de datos de Open Trade Statistics. 

Open Trade Statistics está dividio en varios data frames, donde el "ots_create_tidy_data" es el más útil porqué dejar descargar varios tipos de información de comercio sobre los país en diferentes años, y el data frame que recibas ya está en forma "tidy".

Para poder más fácil filter los datos y elegir solamente los datos que corresponde a la región de América Latina, necesito unir dos data frames de Open Trade Statistics. Para poder utilizar la función "merger" para unir dos data frames, necesito que los dos tienen una columna que tiene el mismo nombre (y obviamente, representa el mismo variable). 

Por eso,  renombro la columna de "reporter_iso" para que corresponde al segundo data frame que voy a utilizar, donde utilizando "country_iso" en vez de "reporter_iso".

```{r comercio API 1, message=FALSE}
comercio_mundo_api <- tradestatistics::ots_create_tidy_data(
  years = 1980:2018, 
  reporters = "all", 
  partners = "all", 
  products = "all") %>%
  rename(country_iso = 'reporter_iso')
```
Después el otro base de datos, descargo la información solamente sobre los países que pertenecer al continente de las Americas:

```{r comercio API 2, message=FALSE}
countries_LATAM <- tradestatistics::ots_countries %>%
  filter(continent == "Americas") 
```

Ahora puedo unir los dos bases de datos, y voy a tener solamente la información disponible para la región de las Americas.

No obstante, en realidad no es toda la región de las Américas que me interesa, sino solamente los países que pertenece a América Latin. Por eso, después de unir los bases de datos, voy a pedir que R me exclude los EEUU, Canada, Gronlandia y otros pequeños territorios estadounidenses y britanicos en el Caribe. Obviamente, se podía discutir si se debería incluir esos últimos somo parte del Caribe, pero acá los excluyo del analisis:
```{r comercio LATAM merge, message=FALSE}
comercio_latam_reducido <- merge(x = comercio_mundo_api, 
                                 y = countries_LATAM,
                                 by = "country_iso") %>%
  filter(country_iso != "usa", # Excluding the U.S.
         country_iso != "can", # Excluding Canada
         country_iso != "grl", # Excluding Greenland
         country_iso != "vir", # Excluding one observation of US Virgin Islands
         country_iso != "umi", # Excluding "United States Minor Outlying Islands"
         country_iso != "vgb", # Excluding British Virgin Islands
         country_iso != "sgs") # Exclude South Georgia and the South Sandwich Islands (British territory)

```

```{r LATAM modify, message=FALSE}
trade_total <- comercio_latam_reducido %>%
  group_by(year) %>%
  mutate(export = sum(export_value_usd),
         import = sum(import_value_usd))
```

```{r LATAM graph, message=FALSE}
ggplot(trade_total) +
  geom_line(aes(year,
                export,
                color = "red")) +
  geom_line(aes(year,
                import,
                color = "blue")) +
  scale_y_continuous(labels = scales::dollar_format()) +
    labs(title = "Export de América Latina",
       y = NULL,
       x = NULL,
       caption = "Fuente: Open Trade Statistics") +
  theme_economist() +
  theme(legend.position = "none")
  
```
